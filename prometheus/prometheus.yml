global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  # Мониторинг самого Prometheus
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # КЛЮЧЕВОЕ ИЗМЕНЕНИЕ: Мониторинг Docker-контейнеров через cAdvisor
  - job_name: 'cadvisor'
    static_configs:
      - targets: ['cadvisor:8080'] # Важно: это имя сервиса в docker-compose

  # Мониторинг хостовой системы (CPU, память, диск, сеть)
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
    # Необязательно: можно добавить метки для группировки, если серверов несколько
    # labels:
    #   group: 'microservices-host'

  # Мониторинг ваших сервисов
  - job_name: 'user-service'
    static_configs:
      - targets: ['user-service:8000']
    metrics_path: /metrics

  - job_name: 'order-service'
    static_configs:
      - targets: ['order-service:8001']
    metrics_path: /metrics

  # Мониторинг Elasticsearch (правильный путь для версии 7.x и 8.x)
  - job_name: 'elasticsearch'
    static_configs:
      - targets: ['elasticsearch:9200']
    metrics_path: /_node/stats/prometheus
